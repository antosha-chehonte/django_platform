# –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –æ—Ç—á–µ—Ç–æ–≤ –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–æ–º

## üìã –û–±—â–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –æ—Ç—á–µ—Ç–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏ –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–æ—Å—Ç—É–ø–æ–≤ –∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–º —Å–∏—Å—Ç–µ–º–∞–º –∏ —Ü–∏—Ñ—Ä–æ–≤—ã—Ö –ø–æ–¥–ø–∏—Å–µ–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤. –û—Ç—á–µ—Ç—ã –¥–æ–ª–∂–Ω—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫—É –ø–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è–º –∏ —ç–∫—Å–ø–æ—Ä—Ç –≤ —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã.

---

## üéØ –°–ø–∏—Å–æ–∫ –æ—Ç—á–µ—Ç–æ–≤

### 1. –û—Ç—á–µ—Ç—ã –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–∏—Å—Ç–µ–º–∞–º

#### 1.1. –°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–æ—Å—Ç—É–ø–æ–≤ –∫ —Å–∏—Å—Ç–µ–º–µ X (—Å –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–æ–π –ø–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è–º)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–æ—Å—Ç—É–ø–æ–≤ –∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ, —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- –°–∏—Å—Ç–µ–º–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π, –≤—ã–±–æ—Ä –∏–∑ ITAsset)
- –°—Ç–∞—Ç—É—Å –¥–æ—Å—Ç—É–ø–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: –∞–∫—Ç–∏–≤–Ω—ã–µ)
- –§–∏–ª—å—Ç—Ä –ø–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—é (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–í—ã–≤–æ–¥–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- –ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ
- –§–ò–û —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
- –î–æ–ª–∂–Ω–æ—Å—Ç—å
- –õ–æ–≥–∏–Ω
- –î–∞—Ç–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞
- –°—Ç–∞—Ç—É—Å
- –î–∞—Ç–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)

**–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞:** –ü–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è–º (—á–µ—Ä–µ–∑ Posts -> Departments)

#### 1.2. –û—Ç—á–µ—Ç –æ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö/–∏—Å—Ç–µ–∫–∞—é—â–∏—Ö –¥–æ—Å—Ç—É–ø–∞—Ö (—Ç—Ä–µ–±—É—é—â–∏—Ö –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –í—ã—è–≤–∏—Ç—å –¥–æ—Å—Ç—É–ø—ã, —Ç—Ä–µ–±—É—é—â–∏–µ –≤–Ω–∏–º–∞–Ω–∏—è –∏ –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- –¢–∏–ø –æ—Ç—á–µ—Ç–∞:
  - –î–æ—Å—Ç—É–ø—ã —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "—Ç—Ä–µ–±—É–µ—Ç –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏"
  - –î–æ—Å—Ç—É–ø—ã —Å –¥–∞—Ç–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –≤ –ø—Ä–æ—à–ª–æ–º (–ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ)
  - –î–æ—Å—Ç—É–ø—ã —Å –¥–∞—Ç–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –≤ –±–ª–∏–∂–∞–π—à–∏–µ N –¥–Ω–µ–π (–∏—Å—Ç–µ–∫–∞—é—â–∏–µ)
- –ü–µ—Ä–∏–æ–¥ –¥–ª—è "–∏—Å—Ç–µ–∫–∞—é—â–∏—Ö" (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 40 –¥–Ω–µ–π)

**–í—ã–≤–æ–¥–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- –ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ
- –§–ò–û —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
- –°–∏—Å—Ç–µ–º–∞
- –õ–æ–≥–∏–Ω
- –°—Ç–∞—Ç—É—Å
- –î–∞—Ç–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞
- –î–∞—Ç–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- –î–Ω–µ–π –¥–æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ / –¥–Ω–µ–π –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–æ

### 2. –û—Ç—á–µ—Ç—ã –¥–ª—è —Ü–∏—Ñ—Ä–æ–≤—ã—Ö –ø–æ–¥–ø–∏—Å–µ–π

#### 2.1. –°–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å –∞–∫—Ç–∏–≤–Ω–æ–π —Ü–∏—Ñ—Ä–æ–≤–æ–π –ø–æ–¥–ø–∏—Å—å—é (—Å –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–æ–π –ø–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è–º)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤, –∏–º–µ—é—â–∏—Ö –∞–∫—Ç–∏–≤–Ω—É—é —Ü–∏—Ñ—Ä–æ–≤—É—é –ø–æ–¥–ø–∏—Å—å.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- –¢–∏–ø —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- –°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: –∞–∫—Ç–∏–≤–Ω—ã–µ)
- –§–∏–ª—å—Ç—Ä –ø–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—é (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–í—ã–≤–æ–¥–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- –ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ
- –§–ò–û —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
- –î–æ–ª–∂–Ω–æ—Å—Ç—å
- –¢–∏–ø —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
- –°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
- –û—Ç–ø–µ—á–∞—Ç–æ–∫ (alias)
- –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
- –°—Ç–∞—Ç—É—Å (–∏—Å—Ç–µ–∫/–∞–∫—Ç–∏–≤–µ–Ω)

**–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞:** –ü–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è–º

#### 2.2. –°–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –±–µ–∑ —Ü–∏—Ñ—Ä–æ–≤–æ–π –ø–æ–¥–ø–∏—Å–∏ (—Å –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–æ–π –ø–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è–º)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –í—ã—è–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤, —É –∫–æ—Ç–æ—Ä—ã—Ö –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∞–∫—Ç–∏–≤–Ω–∞—è —Ü–∏—Ñ—Ä–æ–≤–∞—è –ø–æ–¥–ø–∏—Å—å.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- –§–∏–ª—å—Ç—Ä –ø–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—é (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- –¢–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: –¥–∞)

**–í—ã–≤–æ–¥–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- –ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ
- –§–ò–û —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
- –î–æ–ª–∂–Ω–æ—Å—Ç—å
- Email
- –¢–µ–ª–µ—Ñ–æ–Ω
- –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–õ–æ–≥–∏–∫–∞:** 
- –ù–∞–π—Ç–∏ –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ (Employees.is_active=True)
- –ò—Å–∫–ª—é—á–∏—Ç—å —Ç–µ—Ö, —É –∫–æ–≥–æ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–∞—è —Ü–∏—Ñ—Ä–æ–≤–∞—è –ø–æ–¥–ø–∏—Å—å (DigitalSignature.status='active')
- –°–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –ø–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è–º —á–µ—Ä–µ–∑ Posts

#### 2.3. –û—Ç—á–µ—Ç –æ–± –∏—Å—Ç–µ–∫–∞—é—â–∏—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞—Ö
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –í—ã—è–≤–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã, —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –∫–æ—Ç–æ—Ä—ã—Ö –∏—Å—Ç–µ–∫–∞–µ—Ç –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- –ü–µ—Ä–∏–æ–¥ –∏—Å—Ç–µ—á–µ–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 40 –¥–Ω–µ–π)
- –¢–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: –¥–∞)
- –§–∏–ª—å—Ç—Ä –ø–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—é (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–í—ã–≤–æ–¥–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- –ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ
- –§–ò–û —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
- –î–æ–ª–∂–Ω–æ—Å—Ç—å
- –¢–∏–ø —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
- –°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
- –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
- –î–Ω–µ–π –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è
- –°—Ç–∞—Ç—É—Å

**–õ–æ–≥–∏–∫–∞:** –ù–∞–π—Ç–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã, –≥–¥–µ expiry_date –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ [—Å–µ–≥–æ–¥–Ω—è, —Å–µ–≥–æ–¥–Ω—è + N –¥–Ω–µ–π]

### 3. –≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á–µ—Ç–æ–≤

**–§–æ—Ä–º–∞—Ç—ã —ç–∫—Å–ø–æ—Ä—Ç–∞:**
- CSV (–¥–ª—è –≤—Å–µ—Ö –æ—Ç—á–µ—Ç–æ–≤)
- Excel/XLSX (–¥–ª—è –≤—Å–µ—Ö –æ—Ç—á–µ—Ç–æ–≤)
- PDF (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤)

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥—É–ª—è –æ—Ç—á–µ—Ç–æ–≤

#### 1.1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤
```
apps/access_management/
‚îú‚îÄ‚îÄ reports/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ views.py          # Views –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á–µ—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ utils.py          # –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ forms.py          # –§–æ—Ä–º—ã –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –æ—Ç—á–µ—Ç–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ exports.py        # –§—É–Ω–∫—Ü–∏–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã
‚îî‚îÄ‚îÄ templates/
    ‚îî‚îÄ‚îÄ access_management/
        ‚îî‚îÄ‚îÄ reports/
            ‚îú‚îÄ‚îÄ reports_home.html
            ‚îú‚îÄ‚îÄ system_access_active.html
            ‚îú‚îÄ‚îÄ system_access_expiring.html
            ‚îú‚îÄ‚îÄ digital_signature_active.html
            ‚îú‚îÄ‚îÄ digital_signature_missing.html
            ‚îî‚îÄ‚îÄ digital_signature_expiring.html
```

#### 1.2. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞

**–î–ª—è Excel:**
```python
# requirements.txt
openpyxl>=3.1.0  # –î–ª—è Excel .xlsx
```

**–î–ª—è PDF (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**
```python
# requirements.txt
weasyprint>=59.0  # –ò–ª–∏ reportlab>=4.0
```

**–î–ª—è CSV:**
- –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–æ–¥—É–ª—å Python `csv` (–Ω–µ —Ç—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏)

---

### –≠—Ç–∞–ø 2: –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏ (reports/utils.py)

```python
from django.db.models import Q, OuterRef, Exists
from django.utils import timezone
from datetime import timedelta
from apps.access_management.models import SystemAccess, DigitalSignature
from apps.hr.models import Employees, Posts
from apps.reference.models import Departments


def get_employee_department(employee):
    """
    –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ —á–µ—Ä–µ–∑ –∞–∫—Ç–∏–≤–Ω—É—é –¥–æ–ª–∂–Ω–æ—Å—Ç—å
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç Departments –∏–ª–∏ None
    """
    current_post = Posts.objects.filter(
        employee=employee,
        status=Posts.STATUS_OCCUPIED,
        is_active=True
    ).select_related('department').first()
    
    return current_post.department if current_post else None


def get_system_accesses_by_department(system_id, status='active', department_id=None):
    """
    –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø—ã –∫ —Å–∏—Å—Ç–µ–º–µ, —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è–º
    
    Returns:
        dict: {department: [accesses]}
    """
    accesses = SystemAccess.objects.filter(
        system_id=system_id,
        status=status
    ).select_related('employee', 'system')
    
    if department_id:
        # –§–∏–ª—å—Ç—Ä –ø–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—é
        accesses = accesses.filter(
            employee__posts__department_id=department_id,
            employee__posts__status=Posts.STATUS_OCCUPIED
        )
    
    # –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è–º
    result = {}
    for access in accesses:
        department = get_employee_department(access.employee)
        dept_name = department.name if department else "–ù–µ —É–∫–∞–∑–∞–Ω–æ"
        
        if dept_name not in result:
            result[dept_name] = []
        
        result[dept_name].append({
            'access': access,
            'department': department,
            'employee': access.employee,
            'post': Posts.objects.filter(
                employee=access.employee,
                status=Posts.STATUS_OCCUPIED
            ).select_related('postname', 'department').first()
        })
    
    return result


def get_expiring_accesses(days=40, status_filter=None):
    """
    –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø—ã, —Ç—Ä–µ–±—É—é—â–∏–µ –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–ª–∏ –∏—Å—Ç–µ–∫–∞—é—â–∏–µ
    
    Args:
        days: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è "–∏—Å—Ç–µ–∫–∞—é—â–∏—Ö"
        status_filter: —Ñ–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É (None = –≤—Å–µ —Ç—Ä–µ–±—É—é—â–∏–µ –≤–Ω–∏–º–∞–Ω–∏—è)
    
    Returns:
        list: —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–æ–≤ —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
    """
    today = timezone.now().date()
    future_date = today + timedelta(days=days)
    
    q_objects = Q()
    
    # –î–æ—Å—Ç—É–ø—ã —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "—Ç—Ä–µ–±—É–µ—Ç –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏"
    if status_filter is None or 'needs_update' in status_filter:
        q_objects |= Q(status=SystemAccess.STATUS_NEEDS_UPDATE)
    
    # –î–æ—Å—Ç—É–ø—ã —Å –¥–∞—Ç–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –≤ –ø—Ä–æ—à–ª–æ–º (–ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ)
    if status_filter is None or 'expired' in status_filter:
        q_objects |= Q(
            access_blocked_date__lt=today,
            status__in=[SystemAccess.STATUS_ACTIVE, SystemAccess.STATUS_SUSPENDED]
        )
    
    # –î–æ—Å—Ç—É–ø—ã —Å –¥–∞—Ç–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –≤ –±–ª–∏–∂–∞–π—à–∏–µ N –¥–Ω–µ–π (–∏—Å—Ç–µ–∫–∞—é—â–∏–µ)
    if status_filter is None or 'expiring' in status_filter:
        q_objects |= Q(
            access_blocked_date__gte=today,
            access_blocked_date__lte=future_date,
            status__in=[SystemAccess.STATUS_ACTIVE, SystemAccess.STATUS_SUSPENDED]
        )
    
    accesses = SystemAccess.objects.filter(q_objects).select_related(
        'employee', 'system'
    )
    
    result = []
    for access in accesses:
        department = get_employee_department(access.employee)
        post = Posts.objects.filter(
            employee=access.employee,
            status=Posts.STATUS_OCCUPIED
        ).select_related('postname', 'department').first()
        
        # –†–∞—Å—á–µ—Ç –¥–Ω–µ–π –¥–æ/–ø–æ—Å–ª–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
        days_diff = None
        if access.access_blocked_date:
            days_diff = (access.access_blocked_date - today).days
        
        result.append({
            'access': access,
            'department': department,
            'employee': access.employee,
            'post': post,
            'days_diff': days_diff,
            'is_expired': days_diff < 0 if days_diff is not None else False
        })
    
    return result


def get_employees_with_signature(status='active', cert_type_id=None, department_id=None):
    """
    –ü–æ–ª—É—á–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å –∞–∫—Ç–∏–≤–Ω–æ–π —Ü–∏—Ñ—Ä–æ–≤–æ–π –ø–æ–¥–ø–∏—Å—å—é, —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è–º
    
    Returns:
        dict: {department: [signatures]}
    """
    signatures = DigitalSignature.objects.filter(status=status).select_related(
        'employee', 'certificate_type'
    )
    
    if cert_type_id:
        signatures = signatures.filter(certificate_type_id=cert_type_id)
    
    if department_id:
        signatures = signatures.filter(
            employee__posts__department_id=department_id,
            employee__posts__status=Posts.STATUS_OCCUPIED
        )
    
    result = {}
    for signature in signatures:
        department = get_employee_department(signature.employee)
        dept_name = department.name if department else "–ù–µ —É–∫–∞–∑–∞–Ω–æ"
        
        if dept_name not in result:
            result[dept_name] = []
        
        post = Posts.objects.filter(
            employee=signature.employee,
            status=Posts.STATUS_OCCUPIED
        ).select_related('postname', 'department').first()
        
        result[dept_name].append({
            'signature': signature,
            'department': department,
            'employee': signature.employee,
            'post': post
        })
    
    return result


def get_employees_without_signature(department_id=None, active_only=True):
    """
    –ü–æ–ª—É—á–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –±–µ–∑ –∞–∫—Ç–∏–≤–Ω–æ–π —Ü–∏—Ñ—Ä–æ–≤–æ–π –ø–æ–¥–ø–∏—Å–∏
    
    Returns:
        dict: {department: [employees]}
    """
    # –ù–∞–π—Ç–∏ –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
    employees = Employees.objects.filter(is_active=active_only)
    
    if department_id:
        employees = employees.filter(
            posts__department_id=department_id,
            posts__status=Posts.STATUS_OCCUPIED
        )
    
    # –ò—Å–∫–ª—é—á–∏—Ç—å —Ç–µ—Ö, —É –∫–æ–≥–æ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–∞—è –ø–æ–¥–ø–∏—Å—å
    employees_with_signature = DigitalSignature.objects.filter(
        status=DigitalSignature.STATUS_ACTIVE
    ).values_list('employee_id', flat=True)
    
    employees = employees.exclude(id__in=employees_with_signature)
    
    # –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è–º
    result = {}
    for employee in employees:
        department = get_employee_department(employee)
        dept_name = department.name if department else "–ù–µ —É–∫–∞–∑–∞–Ω–æ"
        
        if dept_name not in result:
            result[dept_name] = []
        
        post = Posts.objects.filter(
            employee=employee,
            status=Posts.STATUS_OCCUPIED
        ).select_related('postname', 'department').first()
        
        result[dept_name].append({
            'employee': employee,
            'department': department,
            'post': post
        })
    
    return result


def get_expiring_signatures(days=40, active_only=True, department_id=None):
    """
    –ü–æ–ª—É—á–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã, —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –∫–æ—Ç–æ—Ä—ã—Ö –∏—Å—Ç–µ–∫–∞–µ—Ç –≤ –±–ª–∏–∂–∞–π—à–∏–µ N –¥–Ω–µ–π
    
    Returns:
        list: —Å–ø–∏—Å–æ–∫ –ø–æ–¥–ø–∏—Å–µ–π —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
    """
    today = timezone.now().date()
    future_date = today + timedelta(days=days)
    
    signatures = DigitalSignature.objects.filter(
        expiry_date__gte=today,
        expiry_date__lte=future_date
    )
    
    if active_only:
        signatures = signatures.filter(status=DigitalSignature.STATUS_ACTIVE)
    
    if department_id:
        signatures = signatures.filter(
            employee__posts__department_id=department_id,
            employee__posts__status=Posts.STATUS_OCCUPIED
        )
    
    signatures = signatures.select_related('employee', 'certificate_type')
    
    result = []
    for signature in signatures:
        department = get_employee_department(signature.employee)
        post = Posts.objects.filter(
            employee=signature.employee,
            status=Posts.STATUS_OCCUPIED
        ).select_related('postname', 'department').first()
        
        days_diff = (signature.expiry_date - today).days
        
        result.append({
            'signature': signature,
            'department': department,
            'employee': signature.employee,
            'post': post,
            'days_diff': days_diff
        })
    
    return result
```

---

### –≠—Ç–∞–ø 3: –§–æ—Ä–º—ã –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –æ—Ç—á–µ—Ç–æ–≤ (reports/forms.py)

```python
from django import forms
from apps.reference.models import ITAsset, Departments
from apps.access_management.models import CertificateType


class SystemAccessActiveReportForm(forms.Form):
    """–§–æ—Ä–º–∞ –¥–ª—è –æ—Ç—á–µ—Ç–∞ –ø–æ –∞–∫—Ç–∏–≤–Ω—ã–º –¥–æ—Å—Ç—É–ø–∞–º –∫ —Å–∏—Å—Ç–µ–º–µ"""
    system = forms.ModelChoiceField(
        queryset=ITAsset.objects.filter(is_active=True),
        label='–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞',
        required=True,
        widget=forms.Select(attrs={'class': 'form-select'})
    )
    status = forms.ChoiceField(
        choices=[
            ('active', '–ê–∫—Ç–∏–≤–Ω—ã–µ'),
            ('suspended', '–ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ'),
            ('blocked', '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ'),
        ],
        initial='active',
        label='–°—Ç–∞—Ç—É—Å –¥–æ—Å—Ç—É–ø–∞',
        widget=forms.Select(attrs={'class': 'form-select'})
    )
    department = forms.ModelChoiceField(
        queryset=Departments.objects.filter(is_active=True),
        label='–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ',
        required=False,
        widget=forms.Select(attrs={'class': 'form-select'}),
        empty_label='–í—Å–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è'
    )


class SystemAccessExpiringReportForm(forms.Form):
    """–§–æ—Ä–º–∞ –¥–ª—è –æ—Ç—á–µ—Ç–∞ –ø–æ –∏—Å—Ç–µ–∫–∞—é—â–∏–º –¥–æ—Å—Ç—É–ø–∞–º"""
    report_type = forms.MultipleChoiceField(
        choices=[
            ('needs_update', '–¢—Ä–µ–±—É—é—Ç –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏'),
            ('expired', '–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ'),
            ('expiring', '–ò—Å—Ç–µ–∫–∞—é—â–∏–µ'),
        ],
        label='–¢–∏–ø –æ—Ç—á–µ—Ç–∞',
        widget=forms.CheckboxSelectMultiple(attrs={'class': 'form-check-input'}),
        initial=['needs_update', 'expired', 'expiring']
    )
    days = forms.IntegerField(
        label='–ü–µ—Ä–∏–æ–¥ –¥–ª—è "–∏—Å—Ç–µ–∫–∞—é—â–∏—Ö" (–¥–Ω–µ–π)',
        initial=40,
        min_value=1,
        max_value=365,
        widget=forms.NumberInput(attrs={'class': 'form-control'})
    )


class DigitalSignatureActiveReportForm(forms.Form):
    """–§–æ—Ä–º–∞ –¥–ª—è –æ—Ç—á–µ—Ç–∞ –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º —Å –∞–∫—Ç–∏–≤–Ω–æ–π –ø–æ–¥–ø–∏—Å—å—é"""
    cert_type = forms.ModelChoiceField(
        queryset=CertificateType.objects.filter(is_active=True),
        label='–¢–∏–ø —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞',
        required=False,
        widget=forms.Select(attrs={'class': 'form-select'}),
        empty_label='–í—Å–µ —Ç–∏–ø—ã'
    )
    status = forms.ChoiceField(
        choices=[
            ('active', '–ê–∫—Ç–∏–≤–Ω—ã–µ'),
            ('revoked', '–ê–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ'),
        ],
        initial='active',
        label='–°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∏',
        widget=forms.Select(attrs={'class': 'form-select'})
    )
    department = forms.ModelChoiceField(
        queryset=Departments.objects.filter(is_active=True),
        label='–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ',
        required=False,
        widget=forms.Select(attrs={'class': 'form-select'}),
        empty_label='–í—Å–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è'
    )


class DigitalSignatureMissingReportForm(forms.Form):
    """–§–æ—Ä–º–∞ –¥–ª—è –æ—Ç—á–µ—Ç–∞ –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º –±–µ–∑ –ø–æ–¥–ø–∏—Å–∏"""
    department = forms.ModelChoiceField(
        queryset=Departments.objects.filter(is_active=True),
        label='–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ',
        required=False,
        widget=forms.Select(attrs={'class': 'form-select'}),
        empty_label='–í—Å–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è'
    )
    active_only = forms.BooleanField(
        label='–¢–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏',
        initial=True,
        required=False,
        widget=forms.CheckboxInput(attrs={'class': 'form-check-input'})
    )


class DigitalSignatureExpiringReportForm(forms.Form):
    """–§–æ—Ä–º–∞ –¥–ª—è –æ—Ç—á–µ—Ç–∞ –ø–æ –∏—Å—Ç–µ–∫–∞—é—â–∏–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º"""
    days = forms.IntegerField(
        label='–ü–µ—Ä–∏–æ–¥ –∏—Å—Ç–µ—á–µ–Ω–∏—è (–¥–Ω–µ–π)',
        initial=40,
        min_value=1,
        max_value=365,
        widget=forms.NumberInput(attrs={'class': 'form-control'})
    )
    active_only = forms.BooleanField(
        label='–¢–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã',
        initial=True,
        required=False,
        widget=forms.CheckboxInput(attrs={'class': 'form-check-input'})
    )
    department = forms.ModelChoiceField(
        queryset=Departments.objects.filter(is_active=True),
        label='–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ',
        required=False,
        widget=forms.Select(attrs={'class': 'form-select'}),
        empty_label='–í—Å–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è'
    )
```

---

### –≠—Ç–∞–ø 4: –§—É–Ω–∫—Ü–∏–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞ (reports/exports.py)

```python
import csv
from django.http import HttpResponse
from openpyxl import Workbook
from openpyxl.styles import Font, Alignment, PatternFill
from openpyxl.utils import get_column_letter
from io import BytesIO


def export_to_csv(data, filename, headers, row_generator):
    """
    –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≤ CSV
    
    Args:
        data: –¥–∞–Ω–Ω—ã–µ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞
        filename: –∏–º—è —Ñ–∞–π–ª–∞
        headers: —Å–ø–∏—Å–æ–∫ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∫–æ–ª–æ–Ω–æ–∫
        row_generator: —Ñ—É–Ω–∫—Ü–∏—è-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å—Ç—Ä–æ–∫ (–ø—Ä–∏–Ω–∏–º–∞–µ—Ç —ç–ª–µ–º–µ–Ω—Ç –¥–∞–Ω–Ω—ã—Ö, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∑–Ω–∞—á–µ–Ω–∏–π)
    """
    response = HttpResponse(content_type='text/csv; charset=utf-8-sig')
    response['Content-Disposition'] = f'attachment; filename="{filename}.csv"'
    
    writer = csv.writer(response)
    writer.writerow(headers)
    
    for item in data:
        row = row_generator(item)
        writer.writerow(row)
    
    return response


def export_to_excel(data, filename, headers, row_generator, sheet_name='–û—Ç—á–µ—Ç'):
    """
    –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≤ Excel
    
    Args:
        data: –¥–∞–Ω–Ω—ã–µ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞
        filename: –∏–º—è —Ñ–∞–π–ª–∞
        headers: —Å–ø–∏—Å–æ–∫ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∫–æ–ª–æ–Ω–æ–∫
        row_generator: —Ñ—É–Ω–∫—Ü–∏—è-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å—Ç—Ä–æ–∫
        sheet_name: –Ω–∞–∑–≤–∞–Ω–∏–µ –ª–∏—Å—Ç–∞
    """
    wb = Workbook()
    ws = wb.active
    ws.title = sheet_name
    
    # –°—Ç–∏–ª–∏ –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
    header_fill = PatternFill(start_color="366092", end_color="366092", fill_type="solid")
    header_font = Font(bold=True, color="FFFFFF")
    
    # –ó–∞–≥–æ–ª–æ–≤–∫–∏
    for col_num, header in enumerate(headers, 1):
        cell = ws.cell(row=1, column=col_num, value=header)
        cell.fill = header_fill
        cell.font = header_font
        cell.alignment = Alignment(horizontal='center', vertical='center')
    
    # –î–∞–Ω–Ω—ã–µ
    for row_num, item in enumerate(data, 2):
        row_data = row_generator(item)
        for col_num, value in enumerate(row_data, 1):
            cell = ws.cell(row=row_num, column=col_num, value=value)
            cell.alignment = Alignment(vertical='top')
    
    # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —à–∏—Ä–∏–Ω–∞ –∫–æ–ª–æ–Ω–æ–∫
    for col_num in range(1, len(headers) + 1):
        column_letter = get_column_letter(col_num)
        max_length = 0
        for row in ws[column_letter]:
            try:
                if len(str(row.value)) > max_length:
                    max_length = len(str(row.value))
            except:
                pass
        adjusted_width = min(max_length + 2, 50)
        ws.column_dimensions[column_letter].width = adjusted_width
    
    response = HttpResponse(
        content_type='application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'
    )
    response['Content-Disposition'] = f'attachment; filename="{filename}.xlsx"'
    
    wb.save(response)
    return response


def export_to_pdf(html_template, context, filename):
    """
    –≠–∫—Å–ø–æ—Ä—Ç –≤ PDF (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É—è weasyprint –∏–ª–∏ reportlab)
    
    –¢—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏: pip install weasyprint
    """
    from django.template.loader import render_to_string
    from weasyprint import HTML, CSS
    from django.conf import settings
    
    html_string = render_to_string(html_template, context)
    
    css = CSS(settings.BASE_DIR / 'static/css/pdf_styles.css')
    pdf_file = HTML(string=html_string).write_pdf(stylesheets=[css])
    
    response = HttpResponse(pdf_file, content_type='application/pdf')
    response['Content-Disposition'] = f'attachment; filename="{filename}.pdf"'
    
    return response
```

---

### –≠—Ç–∞–ø 5: Views –¥–ª—è –æ—Ç—á–µ—Ç–æ–≤ (reports/views.py)

```python
from django.shortcuts import render
from django.contrib.auth.mixins import LoginRequiredMixin
from django.views.generic import View
from django.http import HttpResponse
from .forms import (
    SystemAccessActiveReportForm,
    SystemAccessExpiringReportForm,
    DigitalSignatureActiveReportForm,
    DigitalSignatureMissingReportForm,
    DigitalSignatureExpiringReportForm
)
from .utils import (
    get_system_accesses_by_department,
    get_expiring_accesses,
    get_employees_with_signature,
    get_employees_without_signature,
    get_expiring_signatures
)
from .exports import export_to_csv, export_to_excel
from apps.reference.models import ITAsset, Departments


class ReportsHomeView(LoginRequiredMixin, View):
    """–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ç—á–µ—Ç–æ–≤"""
    def get(self, request):
        return render(request, 'access_management/reports/reports_home.html')


class SystemAccessActiveReportView(LoginRequiredMixin, View):
    """–û—Ç—á–µ—Ç: –ê–∫—Ç–∏–≤–Ω—ã–µ –¥–æ—Å—Ç—É–ø—ã –∫ —Å–∏—Å—Ç–µ–º–µ"""
    def get(self, request):
        form = SystemAccessActiveReportForm(request.GET)
        data = None
        
        if form.is_valid():
            system_id = form.cleaned_data['system'].id
            status = form.cleaned_data['status']
            department_id = form.cleaned_data['department'].id if form.cleaned_data['department'] else None
            
            data = get_system_accesses_by_department(system_id, status, department_id)
        
        format_type = request.GET.get('format', 'html')
        
        if format_type == 'csv':
            return self._export_csv(data, form.cleaned_data.get('system'))
        elif format_type == 'excel':
            return self._export_excel(data, form.cleaned_data.get('system'))
        
        context = {
            'form': form,
            'data': data,
        }
        return render(request, 'access_management/reports/system_access_active.html', context)
    
    def _export_csv(self, data, system):
        headers = ['–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ', '–§–ò–û', '–î–æ–ª–∂–Ω–æ—Å—Ç—å', '–õ–æ–≥–∏–Ω', '–î–∞—Ç–∞ –ø–æ–ª—É—á–µ–Ω–∏—è', '–°—Ç–∞—Ç—É—Å', '–î–∞—Ç–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏']
        
        rows = []
        for dept_name, items in sorted(data.items()):
            for item in items:
                post_name = item['post'].postname.name if item['post'] else "‚Äî"
                rows.append({
                    'department': dept_name,
                    'employee': str(item['employee']),
                    'post': post_name,
                    'login': item['access'].login,
                    'granted_date': item['access'].access_granted_date.strftime('%d.%m.%Y'),
                    'status': item['access'].get_status_display(),
                    'blocked_date': item['access'].access_blocked_date.strftime('%d.%m.%Y') if item['access'].access_blocked_date else "‚Äî"
                })
        
        def row_gen(item):
            return [
                item['department'],
                item['employee'],
                item['post'],
                item['login'],
                item['granted_date'],
                item['status'],
                item['blocked_date']
            ]
        
        filename = f"active_accesses_{system.name if system else 'all'}"
        return export_to_csv(rows, filename, headers, row_gen)
    
    def _export_excel(self, data, system):
        # –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ CSV, –Ω–æ –∏—Å–ø–æ–ª—å–∑—É—è export_to_excel
        # (—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Ö–æ–∂–∞)
        pass


class SystemAccessExpiringReportView(LoginRequiredMixin, View):
    """–û—Ç—á–µ—Ç: –ò—Å—Ç–µ–∫–∞—é—â–∏–µ/–ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –¥–æ—Å—Ç—É–ø—ã"""
    def get(self, request):
        form = SystemAccessExpiringReportForm(request.GET)
        data = None
        
        if form.is_valid():
            report_types = form.cleaned_data['report_type']
            days = form.cleaned_data['days']
            
            data = get_expiring_accesses(days, report_types)
        
        format_type = request.GET.get('format', 'html')
        
        if format_type in ['csv', 'excel']:
            return self._export(data, format_type)
        
        context = {
            'form': form,
            'data': data,
        }
        return render(request, 'access_management/reports/system_access_expiring.html', context)
    
    def _export(self, data, format_type):
        # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞
        pass


class DigitalSignatureActiveReportView(LoginRequiredMixin, View):
    """–û—Ç—á–µ—Ç: –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ —Å –∞–∫—Ç–∏–≤–Ω–æ–π –ø–æ–¥–ø–∏—Å—å—é"""
    def get(self, request):
        form = DigitalSignatureActiveReportForm(request.GET)
        data = None
        
        if form.is_valid():
            status = form.cleaned_data['status']
            cert_type_id = form.cleaned_data['cert_type'].id if form.cleaned_data['cert_type'] else None
            department_id = form.cleaned_data['department'].id if form.cleaned_data['department'] else None
            
            data = get_employees_with_signature(status, cert_type_id, department_id)
        
        format_type = request.GET.get('format', 'html')
        
        if format_type in ['csv', 'excel']:
            return self._export(data, format_type)
        
        context = {
            'form': form,
            'data': data,
        }
        return render(request, 'access_management/reports/digital_signature_active.html', context)
    
    def _export(self, data, format_type):
        # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞
        pass


class DigitalSignatureMissingReportView(LoginRequiredMixin, View):
    """–û—Ç—á–µ—Ç: –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –±–µ–∑ –ø–æ–¥–ø–∏—Å–∏"""
    def get(self, request):
        form = DigitalSignatureMissingReportForm(request.GET)
        data = None
        
        if form.is_valid():
            department_id = form.cleaned_data['department'].id if form.cleaned_data['department'] else None
            active_only = form.cleaned_data['active_only']
            
            data = get_employees_without_signature(department_id, active_only)
        
        format_type = request.GET.get('format', 'html')
        
        if format_type in ['csv', 'excel']:
            return self._export(data, format_type)
        
        context = {
            'form': form,
            'data': data,
        }
        return render(request, 'access_management/reports/digital_signature_missing.html', context)
    
    def _export(self, data, format_type):
        # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞
        pass


class DigitalSignatureExpiringReportView(LoginRequiredMixin, View):
    """–û—Ç—á–µ—Ç: –ò—Å—Ç–µ–∫–∞—é—â–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã"""
    def get(self, request):
        form = DigitalSignatureExpiringReportForm(request.GET)
        data = None
        
        if form.is_valid():
            days = form.cleaned_data['days']
            active_only = form.cleaned_data['active_only']
            department_id = form.cleaned_data['department'].id if form.cleaned_data['department'] else None
            
            data = get_expiring_signatures(days, active_only, department_id)
        
        format_type = request.GET.get('format', 'html')
        
        if format_type in ['csv', 'excel']:
            return self._export(data, format_type)
        
        context = {
            'form': form,
            'data': data,
        }
        return render(request, 'access_management/reports/digital_signature_expiring.html', context)
    
    def _export(self, data, format_type):
        # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞
        pass
```

---

### –≠—Ç–∞–ø 6: URLs –¥–ª—è –æ—Ç—á–µ—Ç–æ–≤

```python
# apps/access_management/urls.py (–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ)

urlpatterns += [
    # –û—Ç—á–µ—Ç—ã
    path('reports/', views.ReportsHomeView.as_view(), name='reports_home'),
    path('reports/system-access/active/', reports.SystemAccessActiveReportView.as_view(), name='report_system_access_active'),
    path('reports/system-access/expiring/', reports.SystemAccessExpiringReportView.as_view(), name='report_system_access_expiring'),
    path('reports/digital-signature/active/', reports.DigitalSignatureActiveReportView.as_view(), name='report_signature_active'),
    path('reports/digital-signature/missing/', reports.DigitalSignatureMissingReportView.as_view(), name='report_signature_missing'),
    path('reports/digital-signature/expiring/', reports.DigitalSignatureExpiringReportView.as_view(), name='report_signature_expiring'),
]
```

---

### –≠—Ç–∞–ø 7: –®–∞–±–ª–æ–Ω—ã –æ—Ç—á–µ—Ç–æ–≤

#### 7.1. –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ç—á–µ—Ç–æ–≤ (reports_home.html)

```django
{% extends "base.html" %}

{% block content %}
<h2>–û—Ç—á–µ—Ç—ã –ø–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –¥–æ—Å—Ç—É–ø–æ–º</h2>

<div class="row mt-4">
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h5>–û—Ç—á–µ—Ç—ã –ø–æ –¥–æ—Å—Ç—É–ø–∞–º –∫ —Å–∏—Å—Ç–µ–º–∞–º</h5>
            </div>
            <div class="card-body">
                <ul class="list-unstyled">
                    <li class="mb-2">
                        <a href="{% url 'access:report_system_access_active' %}" class="btn btn-outline-primary w-100">
                            –ê–∫—Ç–∏–≤–Ω—ã–µ –¥–æ—Å—Ç—É–ø—ã –∫ —Å–∏—Å—Ç–µ–º–µ
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'access:report_system_access_expiring' %}" class="btn btn-outline-primary w-100">
                            –ò—Å—Ç–µ–∫–∞—é—â–∏–µ/–ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –¥–æ—Å—Ç—É–ø—ã
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h5>–û—Ç—á–µ—Ç—ã –ø–æ —Ü–∏—Ñ—Ä–æ–≤—ã–º –ø–æ–¥–ø–∏—Å—è–º</h5>
            </div>
            <div class="card-body">
                <ul class="list-unstyled">
                    <li class="mb-2">
                        <a href="{% url 'access:report_signature_active' %}" class="btn btn-outline-primary w-100">
                            –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ —Å –∞–∫—Ç–∏–≤–Ω–æ–π –ø–æ–¥–ø–∏—Å—å—é
                        </a>
                    </li>
                    <li class="mb-2">
                        <a href="{% url 'access:report_signature_missing' %}" class="btn btn-outline-primary w-100">
                            –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –±–µ–∑ –ø–æ–¥–ø–∏—Å–∏
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'access:report_signature_expiring' %}" class="btn btn-outline-primary w-100">
                            –ò—Å—Ç–µ–∫–∞—é—â–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>

<div class="mt-3">
    <a href="{% url 'access:home' %}" class="btn btn-secondary">–ù–∞–∑–∞–¥</a>
</div>
{% endblock %}
```

#### 7.2. –ü—Ä–∏–º–µ—Ä —à–∞–±–ª–æ–Ω–∞ –æ—Ç—á–µ—Ç–∞ (system_access_active.html)

```django
{% extends "base.html" %}

{% block content %}
<h2>–û—Ç—á–µ—Ç: –ê–∫—Ç–∏–≤–Ω—ã–µ –¥–æ—Å—Ç—É–ø—ã –∫ —Å–∏—Å—Ç–µ–º–µ</h2>

<form method="get" class="card mb-4">
    <div class="card-body">
        <div class="row g-3">
            <div class="col-md-4">
                {{ form.system.label_tag }}
                {{ form.system }}
            </div>
            <div class="col-md-3">
                {{ form.status.label_tag }}
                {{ form.status }}
            </div>
            <div class="col-md-3">
                {{ form.department.label_tag }}
                {{ form.department }}
            </div>
            <div class="col-md-2 d-flex align-items-end">
                <button type="submit" class="btn btn-primary w-100">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>
</form>

{% if data %}
    <div class="d-flex justify-content-end mb-3">
        <a href="?{{ request.GET.urlencode }}&format=csv" class="btn btn-sm btn-success me-2">–≠–∫—Å–ø–æ—Ä—Ç CSV</a>
        <a href="?{{ request.GET.urlencode }}&format=excel" class="btn btn-sm btn-success">–≠–∫—Å–ø–æ—Ä—Ç Excel</a>
    </div>
    
    {% for dept_name, items in data.items|dictsort:0 %}
        <div class="card mb-3">
            <div class="card-header">
                <h5>{{ dept_name }} ({{ items|length }})</h5>
            </div>
            <div class="card-body">
                <table class="table table-sm">
                    <thead>
                        <tr>
                            <th>–§–ò–û</th>
                            <th>–î–æ–ª–∂–Ω–æ—Å—Ç—å</th>
                            <th>–õ–æ–≥–∏–Ω</th>
                            <th>–î–∞—Ç–∞ –ø–æ–ª—É—á–µ–Ω–∏—è</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>–î–∞—Ç–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in items %}
                        <tr>
                            <td><a href="{% url 'hr:employee_detail' item.employee.pk %}">{{ item.employee }}</a></td>
                            <td>{{ item.post.postname.name|default:"‚Äî" }}</td>
                            <td><strong>{{ item.access.login }}</strong></td>
                            <td>{{ item.access.access_granted_date|date:"d.m.Y" }}</td>
                            <td><span class="badge bg-success">{{ item.access.get_status_display }}</span></td>
                            <td>{{ item.access.access_blocked_date|date:"d.m.Y"|default:"‚Äî" }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    {% endfor %}
{% else %}
    <div class="alert alert-info">
        –í—ã–±–µ—Ä–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á–µ—Ç–∞
    </div>
{% endif %}

<div class="mt-3">
    <a href="{% url 'access:reports_home' %}" class="btn btn-secondary">–ù–∞–∑–∞–¥ –∫ –æ—Ç—á–µ—Ç–∞–º</a>
</div>
{% endblock %}
```

---

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install openpyxl>=3.1.0
# –î–ª—è PDF (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
pip install weasyprint>=59.0
```

---

## ‚úÖ –ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **–≠—Ç–∞–ø 1**: –°–æ–∑–¥–∞—Ç—å –º–æ–¥—É–ª—å `reports/` –∏ –±–∞–∑–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
2. **–≠—Ç–∞–ø 2**: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —É—Ç–∏–ª–∏—Ç—ã (`utils.py`)
3. **–≠—Ç–∞–ø 3**: –°–æ–∑–¥–∞—Ç—å —Ñ–æ—Ä–º—ã –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –æ—Ç—á–µ—Ç–æ–≤ (`forms.py`)
4. **–≠—Ç–∞–ø 4**: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞ (`exports.py`)
5. **–≠—Ç–∞–ø 5**: –°–æ–∑–¥–∞—Ç—å Views –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ—Ç—á–µ—Ç–∞ (`views.py`)
6. **–≠—Ç–∞–ø 6**: –î–æ–±–∞–≤–∏—Ç—å URLs
7. **–≠—Ç–∞–ø 7**: –°–æ–∑–¥–∞—Ç—å —à–∞–±–ª–æ–Ω—ã –¥–ª—è –≤—Å–µ—Ö –æ—Ç—á–µ—Ç–æ–≤
8. **–≠—Ç–∞–ø 8**: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

---

## üîç –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è–º

**–í–∞–∂–Ω–æ:** –£ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å:
- –û–¥–Ω–∞ –∞–∫—Ç–∏–≤–Ω–∞—è –¥–æ–ª–∂–Ω–æ—Å—Ç—å (Posts —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º 'occupied')
- –ù–µ—Å–∫–æ–ª—å–∫–æ –¥–æ–ª–∂–Ω–æ—Å—Ç–µ–π (–ø—Ä–∏ —Ä–∞–±–æ—Ç–µ –Ω–∞ —Å—Ç–∞–≤–∫–∞—Ö)
- –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –¥–æ–ª–∂–Ω–æ—Å—Ç–∏ (–Ω–æ–≤—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫, —É–≤–æ–ª–µ–Ω–Ω—ã–π)

**–ü–æ–¥—Ö–æ–¥:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Posts.objects.filter(employee=employee, status=Posts.STATUS_OCCUPIED).first()` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–π –¥–æ–ª–∂–Ω–æ—Å—Ç–∏
- –ï—Å–ª–∏ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏ –Ω–µ—Ç, –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –≤ "–ù–µ —É–∫–∞–∑–∞–Ω–æ"

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `select_related()` –¥–ª—è ForeignKey
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `prefetch_related()` –¥–ª—è ManyToMany (–µ—Å–ª–∏ –±—É–¥–µ—Ç)
- –ò–∑–±–µ–≥–∞—Ç—å N+1 –∑–∞–ø—Ä–æ—Å–æ–≤ –ø—Ä–∏ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–µ

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- –î–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö –æ—Ç—á–µ—Ç–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –±–æ–ª—å—à–∏—Ö –æ—Ç—á–µ—Ç–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –±—É–¥—É—â–µ–≥–æ)

---

## üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ (–±—É–¥—É—â–µ–µ)

1. **–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–æ–≤**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ email
2. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç—á–µ—Ç–æ–≤**: –ò—Å—Ç–æ—Ä–∏—è —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤
3. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã**: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
4. **–ì—Ä–∞—Ñ–∏–∫–∏ –∏ –¥–∏–∞–≥—Ä–∞–º–º—ã**: –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ –æ—Ç—á–µ—Ç–∞—Ö

