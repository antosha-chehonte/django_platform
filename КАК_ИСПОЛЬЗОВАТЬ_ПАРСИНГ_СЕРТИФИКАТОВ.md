# Как использовать парсинг сертификатов

## Быстрый старт

### Шаг 1: Откройте форму создания цифровой подписи

1. Перейдите на главную страницу платформы
2. Выберите **"Управление доступами"**
3. Нажмите **"Перейти к подписям"** или **"Цифровые подписи"**
4. Нажмите кнопку **"Добавить подпись"** (в правом верхнем углу)

**Прямая ссылка:** `/access/signatures/create/`

### Шаг 2: Загрузите файл сертификата

1. В форме создания цифровой подписи найдите поле **"Файл сертификата"**
2. Нажмите **"Выбрать файл"** и выберите ваш `.cer` или `.pfx` файл
3. **Важно:** Убедитесь, что чекбокс **"Автоматически заполнить данные из файла сертификата"** включен (включен по умолчанию)

### Шаг 3: Автоматическое заполнение

После выбора файла произойдет одно из двух:

**Вариант А: JavaScript работает (рекомендуется)**
- Поля автоматически заполнятся **сразу после выбора файла**
- Вы увидите сообщение "✅ Успешно! Поля автоматически заполнены"
- Заполненные поля будут подсвечены зеленой рамкой

**Вариант Б: JavaScript не работает**
- Заполните остальные обязательные поля (Сотрудник, Тип сертификата)
- Нажмите **"Сохранить"**
- При сохранении произойдет автоматическое заполнение полей из файла

### Шаг 4: Проверьте и сохраните

1. Проверьте заполненные поля:
   - ✅ Серийный номер сертификата
   - ✅ Отпечаток сертификата
   - ✅ Дата окончания действия
   - ✅ Статус (определен автоматически)

2. Заполните обязательные поля, которые не заполняются автоматически:
   - **Сотрудник** - выберите из списка
   - **Тип сертификата** - выберите из справочника

3. Нажмите **"Сохранить"**

## Что заполняется автоматически?

При загрузке файла `.cer` или `.pfx` автоматически заполняются:

| Поле | Что извлекается |
|------|----------------|
| **Серийный номер** | Уникальный номер сертификата |
| **Отпечаток** | SHA-1 fingerprint (отпечаток) сертификата |
| **Дата окончания** | Дата окончания срока действия |
| **Статус** | "Активна" или "Требует актуализации" (в зависимости от срока) |
| **Примечания** | Информация о субъекте и издателе (если поле пустое) |

## Поддерживаемые форматы

- ✅ **.cer** - сертификаты в формате DER (бинарный) или PEM (текстовый)
- ✅ **.pfx** - сертификаты в формате PKCS12 (⚠️ файлы с паролем пока не поддерживаются)

## Решение проблем

### Поля не заполняются автоматически

**Проблема:** После выбора файла поля остаются пустыми

**Решения:**
1. Убедитесь, что чекбокс "Автоматически заполнить данные из файла сертификата" включен
2. Проверьте формат файла (должен быть `.cer` или `.pfx`)
3. Попробуйте нажать "Сохранить" - заполнение произойдет при сохранении
4. Проверьте консоль браузера на наличие ошибок JavaScript

### Ошибка при обработке файла

**Проблема:** Появляется сообщение об ошибке при обработке файла

**Возможные причины:**
- Неправильный формат файла
- Файл поврежден
- Файл слишком большой (максимум 1 МБ)

**Решение:**
- Проверьте формат файла
- Попробуйте открыть файл в другом приложении, чтобы убедиться, что он не поврежден
- Заполните поля вручную

### Файл .pfx требует пароль

**Проблема:** Файл `.pfx` не обрабатывается

**Решение:**
- В текущей версии файлы `.pfx` с паролем не поддерживаются
- Экспортируйте сертификат в формате `.cer` без пароля
- Или заполните поля вручную

## Пример использования

1. **Откройте:** `/access/signatures/create/`
2. **Выберите сотрудника** из списка
3. **Выберите тип сертификата** из справочника
4. **Загрузите файл** `certificate.cer`
5. **Поля заполнятся автоматически:**
   - Серийный номер: `00BE7798D6824402891B4A5FCCDE076788`
   - Отпечаток: `A1 B2 C3 D4 E5 F6...`
   - Дата окончания: `01.11.2024`
   - Статус: `Активна` (если дата в будущем)
6. **Нажмите "Сохранить"**

## Дополнительная информация

Более подробная техническая документация находится в файле `CERTIFICATE_PARSING_README.md`

## Вопросы?

Если у вас возникли проблемы:
1. Проверьте, что библиотека `cryptography` установлена: `pip install cryptography`
2. Проверьте логи Django на наличие ошибок
3. Убедитесь, что файл сертификата не поврежден



